<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedNexus - Second Brain</title>
    
    <!-- 1. Tailwind CSS (Visual) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            'from': { opacity: '0' },
                            'to': { opacity: '1' },
                        },
                        slideUp: {
                            'from': { opacity: '0', transform: 'translateY(20px)' },
                            'to': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideDown: {
                            'from': { transform: 'translateY(-100%)' },
                            'to': { transform: 'translateY(0)' },
                        }
                    },
                    colors: {
                        netflix: {
                            black: '#141414',
                            dark: '#181818',
                            red: '#E50914',
                            hover: '#b20710'
                        }
                    }
                }
            }
        }
    </script>

    <!-- 2. Fonte Inter (Google Fonts) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- 3. React & ReactDOM & Babel -->
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.263.1"
            }
        }
    </script>
    <script type="module" src="https://esm.sh/run"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Estilização da barra de rolagem fina */
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background-color: #334155; border-radius: 20px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background-color: #475569; }
    </style>
</head>
<body class="bg-[#0F172A] text-slate-300">
    <div id="root"></div>

    <!-- 4. Aplicação React -->
    <script type="text/babel" data-type="module">
        import React, { useState, useRef, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            BookOpen, Brain, Activity, Stethoscope, FileText, Calendar, 
            Search, Bell, ChevronRight, ChevronLeft, PlayCircle, FolderOpen, 
            ArrowLeft, GraduationCap, Microscope, Users, PlusCircle, Save, Check, ExternalLink, FileSearch, FileQuestion, X,
            Play, MonitorPlay, Library, ListVideo, CheckCircle2, Lock
        } from 'lucide-react';

        // --- DADOS DAS AULAS: ANATOMIA DO SISTEMA LOCOMOTOR ---
        const LOCOMOTOR_LESSONS = [
            { title: "Divisão do Sistema Esquelético e Ossos do Crânio", videoId: "3zIB_Yx_KIo" },
            { title: "Músculos Cabeça e Pescoço", videoId: "63Tu1eWZU1Y" },
            { title: "Ossos da Face", videoId: "5SUxOhF9bdA" },
            { title: "Articulação Sinovial", videoId: "KUWhdX_LzRE" },
            { title: "Artrologia", videoId: "d89ulYm9rTA" },
            { title: "Classificação Morfológica dos Ossos", videoId: "yrIU8b-FZso" },
            { title: "Miologia", videoId: "wwVtP2nRxxo" },
            { title: "Articulações do Esqueleto Apendicular Inferior", videoId: "fxFlx8rm1UA" },
            { title: "Esqueleto Apendicular Inferior", videoId: "z_sKd0Ko67Q" },
            { title: "Músculos do Joelho e Perna", videoId: "ADWXcTztMzQ" },
            { title: "Músculos do Quadril e Coxa", videoId: "cgOv-a5u7q0" },
            { title: "Articulações do Esqueleto Apendicular Superior – Cintura Escapular", videoId: "iajeQaLJgUo" },
            { title: "Articulações do Esqueleto Apendicular Superior – Cotovelo, Punho e Mão", videoId: "-p5J5jeGy38" },
            { title: "Esqueleto Apendicular Superior", videoId: "YjihTDIP-8I" },
            { title: "Músculos da Cintura Escapular, Ombro e Braço", videoId: "SSHRk3UBJqY" },
            { title: "Músculos do Antebraço", videoId: "bVJXllkIkhM" },
            { title: "Músculos Intrínsecos da Mão", videoId: "kRqAy4COqW8" },
            { title: "Articulações do Esqueleto Axial", videoId: "pnRpgeh94vQ" },
            { title: "Músculos do Tronco", videoId: "7axOXHcKg7Y" },
            { title: "Ossos do Tronco", videoId: "zD5caxpgPq8" }
        ];

        // --- DADOS DAS AULAS: SISTEMA REPRODUTOR ---
        const REPRODUTOR_LESSONS = [
            { title: "Aparelho Reprodutor Feminino – Ovários e Tubas Uterinas #Aprenda 2", videoId: "dRndcgLMKxE" },
            { title: "Aparelho Reprodutor Feminino – Ovários e Tubas Uterinas #Aprenda", videoId: "_vM2Theh8aQ" },
            { title: "Aparelho Reprodutor Feminino – Útero, Vagina e Genitália Externa", videoId: "hlvWc92TCbU" },
            { title: "Aula – Aparelho Reprodutor Feminino – Útero #Aprenda", videoId: "AO-yzIQRTgA" },
            { title: "Histologia do Sistema Reprodutor Feminino #Aprenda", videoId: "g6wRCU67uPk" },
            { title: "Fisiologia do Sistema Reprodutor Feminino – Ciclo Menstrual #Aprenda", videoId: "Ms2f95zIvPE" },
            { title: "Fisiologia do Sistema Reprodutor Feminino – Hormônios e sua Regulação", videoId: "wshjJA7rDxQ" },
            { title: "Anatomia da Mama #Aprenda", videoId: "mJLCxaElpyw" },
            { title: "Gestação #Aprenda", videoId: "z1jTp44Hsi0" },
            { title: "Lactação #Aprenda", videoId: "HY3a1H50FNQ" },
            { title: "Aparelho Reprodutor Masculino #Aprenda", videoId: "KYtjV0Zzsy8" },
            { title: "Aparelho Reprodutor Masculino – Ducto Deferente e Funículo Espermático", videoId: "gyy5mfnqSpU" },
            { title: "Aparelho Reprodutor Masculino – Glândula Seminal e Próstata #Aprenda", videoId: "L67P-boFlsU" },
            { title: "Aparelho Reprodutor Masculino – Pênis #Aprenda", videoId: "pgkoZ-HZ6p0" },
            { title: "Aparelho Reprodutor Masculino – Testículo e Epidídimo #Aprenda", videoId: "4oSx4DoxgjA" }
        ];

        // --- DADOS DAS AULAS: EMBRIOLOGIA ---
        const EMBRIOLOGIA_LESSONS = [
            { title: "Gametogênese", videoId: "tMXgjHq61wQ" },
            { title: "Fecundação", videoId: "O9YsUhCQv64" },
            { title: "Zigoto e Blastocisto", videoId: "-iuWA5CQCMI" },
            { title: "Âmnio e Celoma", videoId: "i29YGecX9UQ" },
            { title: "Córion", videoId: "HbQ8Zpex0AA" },
            { title: "Membranas Fetais", videoId: "a3zj8iowhJ8" },
            { title: "Gastrulação", videoId: "HVVclowB9qI" },
            { title: "Notocorda e Tubo Neural", videoId: "XUD3IUNK7Vk" },
            { title: "Somitos, Celoma Intra e Sistema Cardiovascular", videoId: "7rYQMJzQoYg" },
            { title: "Organogênese e Dobramento do Embrião", videoId: "iu5VjWLLoKU" },
            { title: "Embriologia da 4ª à 8ª Semana", videoId: "tSqOhvdTDnc" },
            { title: "Embriologia da 9ª Semana ao Nascimento", videoId: "aFEVmlbJ708" },
            { title: "Cavidades do Corpo Embrionário", videoId: "L2IZEut6Yok" },
            { title: "Desenvolvimento do Diafragma", videoId: "CeDWt2Qg3UE" },
            { title: "Arcos Faríngeos e Derivados", videoId: "WEzfPk3OJ9o" },
            { title: "Bolsas, Sulcos e Membranas Faríngeas", videoId: "Wxo8xMksxiU" },
            { title: "Embriologia do Pescoço", videoId: "axyh2MK-XDU" },
            { title: "Embriologia da Face", videoId: "iExD4xImT24" },
            { title: "Embriologia do Palato", videoId: "xQO9_OJmuCI" },
            { title: "Primórdio Respiratório e Faringe", videoId: "fnJnYip6qWA" },
            { title: "Traqueia, Brônquios e Pulmões", videoId: "f2k4ng4kLzQ" },
            { title: "Maturação Pulmonar", videoId: "7ydEZDWXWmg" },
            { title: "Intestino Anterior: Esôfago e Estômago", videoId: "kDNHoeo5Yio" },
            { title: "Intestino Anterior: Bolsa Omental e Duodeno", videoId: "IqL5Icry-ZQ" },
            { title: "Intestino Anterior: Fígado, Vesícula Biliar e Sistema Biliar", videoId: "V3gyiEpoEXA" },
            { title: "Intestino Anterior: Pâncreas e Baço", videoId: "D4GpR1-IJ5M" },
            { title: "Intestino Médio: Herniação, Rotação e Fixação", videoId: "MvR0FbqGD_Y" },
            { title: "Intestino Médio: Ceco, Apêndice e Anomalias", videoId: "XU-voGzqC_c" },
            { title: "Intestino Posterior: Derivados e Cloaca", videoId: "kCVHiNzogbI" },
            { title: "Intestino Posterior: Canal Anal e Anomalias", videoId: "hRYdGI-D-aM" },
            { title: "Desenvolvimento do Coração e Vasos Sanguíneos", videoId: "8ivU4plbcUw" },
            { title: "Sistema Urogenital: Pronefron e Mesonefron", videoId: "L-M2H296atc" },
            { title: "Sistema Urinário: Rins Metanefron e Ureteres", videoId: "y1e_gD80CDU" },
            { title: "Sistema Urinário: Mudança Posicional dos Rins", videoId: "6a6NlPFMsUw" },
            { title: "Sistema Urinário: Uretra, Suprarrenais e Hiperplasia", videoId: "-4rOo49djco" },
            { title: "Sistema Urinário: Bexiga e Defeitos Congênitos", videoId: "Tow8vrGpf6A" },
            { title: "Desenvolvimento das Gônadas Indiferenciadas", videoId: "Sb62GtZf0LY" },
            { title: "Desenvolvimento dos Testículos e Ovários", videoId: "JAQPFnvPcqg" },
            { title: "Ductos Genitais e Glândulas Masculinas", videoId: "NEaIM5XcWQQ" },
            { title: "Ductos, Glândulas Femininas e Vagina", videoId: "hOOyLb18Y0g" },
            { title: "Genitálias Externas Masculinas", videoId: "ndwz9H7n6T4" },
            { title: "Canal Inguinal e Descida dos Testículos", videoId: "IA4m_VyzUrU" },
            { title: "Placenta", videoId: "BbYOX4kR3vc" }
        ];

        // --- DADOS DA BIBLIOTECA ---
        const LIBRARY_DATA = [
            {
                id: 'medresumos',
                title: 'MedResumos',
                type: 'folder',
                description: 'Resumos e materiais de apoio',
                icon: <BookOpen size={24} />,
                color: 'from-amber-600 to-amber-800',
                children: [
                    {
                        id: 'ciclo_basico',
                        title: 'Ciclo Básico Modular',
                        type: 'folder',
                        description: 'Materiais do Ciclo Básico (2023)',
                        icon: <Microscope size={24} />,
                        color: 'from-emerald-600 to-emerald-800',
                        children: [
                            { title: '(2023) SOI – Célula – Estrutura e Função (CEF)', url: 'https://drive.google.com/file/d/1aGPlYiBJeyWni6XhuL4xM6G4ONFlw8-X/view', type: 'file' },
                            { title: '(2023) SOI – Organização Morfo-Funcional (OMF) – Sistema Locomotor', url: 'https://drive.google.com/file/d/17z7biFG7HnGzXP69IFGP0sUlAseVvK6d/view', type: 'file' },
                            { title: '(2023) SOI – Organização Morfo-Funcional (OMF) – Sistema Nervoso', url: 'https://drive.google.com/file/d/1vhk7rj5C8bBUudPlTVGiiEUbpf6pKxrn/view', type: 'file' },
                            { title: '(2023) SOI – Sistema Cardiovascular', url: 'https://drive.google.com/file/d/1Qx1vo1Sl_Ohozjh3yHsX9IJkne-A3yy7/view', type: 'file' },
                            { title: '(2023) SOI – Sistema Digestório', url: 'https://drive.google.com/file/d/1y9QXoRm7LLSbpTCTx2XkQQTN8pKoFtJa/view', type: 'file' },
                            { title: '(2023) SOI – Sistema Endócrino, Reprodução e Desenvolvimento', url: 'https://drive.google.com/file/d/1ES-pf6mpaKUEZsDjp4JdWWxuMlJtncee/view', type: 'file' },
                            { title: '(2023) SOI – Sistema Imune e MAD', url: 'https://drive.google.com/file/d/1jHwT0JjsA3P1uC3RWkAW14aGRDGv8gph/view', type: 'file' },
                            { title: '(2023) SOI – Sistema Locomotor', url: 'https://drive.google.com/file/d/1zQI-lCp3elcEfafZDtcBWcywvVaNi3HT/view', type: 'file' },
                            { title: '(2023) SOI – Sistema Nervoso', url: 'https://drive.google.com/file/d/1l5wXJ5xKAwa4uKuaHCKZiE-vZnwON_MF/view', type: 'file' },
                            { title: '(2023) SOI – Sistema Respiratório', url: 'https://drive.google.com/file/d/1IwUq0uy6sO79iXPonPxiNosLX0NJh9-c/view', type: 'file' },
                            { title: '(2023) SOI – Sistema Urinário', url: 'https://drive.google.com/file/d/1dsg45xLP_xVH_P7Dp9p03HETpEKsHJFT/view', type: 'file' }
                        ]
                    }
                ]
            }
        ];

        // --- LISTAS DE CURSOS GERAIS ---
        const SANAR_COURSES_TITLES = [
            "Anatomia do Sistema Locomotor", "Anatomia dos Órgãos e Sistemas", "Antibioticoterapia",
            "Atendimento Pré-Hospitalar", "Biofísica", "Biologia Molecular e Celular", "Bioquímica",
            "Eletrocardiograma (ECG)", "Embriologia", "Exames Laboratoriais", "Farmacologia",
            "Fisiologia", "Genética", "Histologia", "Microbiologia", "Neuroanatomia", "Parasitologia",
            "Patologia", "Primeiros Socorros", "Radiologia", "Semiologia", "Sistema Circulatório",
            "Sistema Digestório", "Sistema Endócrino", "Sistema Hematopoiético", "Sistema Imune",
            "Sistema Nervoso", "Sistema Reprodutor", "Sistema Respiratório", "Sistema Urinário e Renal",
            "Trauma"
        ];

        const EMR_MODULES = [
            "CIR – Bases Cirúrgicas", "CIR – Emergências Cirúrgicas", "CIR – Especialidades Cirúrgicas", "CIR – Icterícia",
            "CM – Anemias e Pancitopenias", "CM – Artropatias e Doenças da Autoimunidade", "CM – Dermatologia", "CM – Diarreia",
            "CM – Dispneia e Tosse", "CM – Distúrbios da Hemostasia", "CM – Distúrbios Endócrinos", "CM – Doenças Infecciosas Endêmicas",
            "CM – Doenças Renais e das Vias Urinárias", "CM – Dor Torácica", "CM – Neurologia", "CM – O Paciente Idoso",
            "CM – Principais Emergências Clínicas", "CM – Principais Transtornos Psiquiátricos", "CR – Disfagia e Dispepsia",
            "GO – Ambulatório de Ginecologia", "GO – Assistência Obstétrica", "GO – Intercorrências na Gestação e no Puerpério",
            "PED – Emergências Pediátricas", "PED – Especialidades", "PED – Neonatologia", "PED – Puericultura",
            "PREV – Medicina Preventiva", "Revisão SES-PE"
        ];

        // --- DADOS COMPLETOS ---
        const DATA = {
            // --- PLATAFORMAS (CURSOS PRINCIPAIS) ---
            platforms: {
                sanar: {
                    id: 'sanar_main',
                    title: 'SanarFlix',
                    subtitle: 'Plataforma de Streaming',
                    theme: 'red',
                    icon: <Play size={28} fill="currentColor" />,
                    color: 'from-red-600 to-red-900',
                    image: 'Tutoria/sanarflix/Sanar.png',
                    // Mapeamento especial para incluir as aulas nos cursos específicos
                    subcourses: SANAR_COURSES_TITLES.map((title, index) => {
                        const isLocomotor = title === "Anatomia do Sistema Locomotor";
                        const isReprodutor = title === "Sistema Reprodutor";
                        const isEmbriologia = title === "Embriologia";
                        
                        let lessons = [];
                        let duration = 'Vídeo';
                        let type = 'Curso';

                        if (isLocomotor) {
                            lessons = LOCOMOTOR_LESSONS;
                            duration = '20 Aulas';
                            type = 'Curso Completo';
                        } else if (isReprodutor) {
                            lessons = REPRODUTOR_LESSONS;
                            duration = '15 Aulas';
                            type = 'Curso Completo';
                        } else if (isEmbriologia) {
                            lessons = EMBRIOLOGIA_LESSONS;
                            duration = '43 Aulas';
                            type = 'Curso Completo';
                        }

                        return {
                            id: `sf-c-${index}`, 
                            title: title, 
                            type: type, 
                            duration: duration,
                            lessons: lessons,
                            color: 'from-red-600 to-red-800'
                        };
                    }),
                    problems: [], questions: []
                },
                emr: {
                    id: 'emr_main',
                    title: 'Eu Médico Residente',
                    subtitle: 'Extensivo & Revisão',
                    theme: 'green',
                    icon: <Stethoscope size={28} />,
                    color: 'from-emerald-600 to-emerald-900',
                    image: 'Cursos/EMR/EMR.png', // Imagem de capa
                    subcourses: EMR_MODULES.map((title, index) => ({
                        id: `emr-c-${index}`, title: title, type: 'Módulo EMR', duration: 'Aulas',
                        color: 'from-emerald-600 to-emerald-800'
                    })),
                    problems: [], questions: []
                }
            },
            
            basico: {
                title: "Ciclo Básico",
                icon: <Microscope size={20} />,
                subjects: [
                    {
                        id: 'anat', title: 'Anatomia Humana', color: 'from-emerald-500 to-emerald-700',
                        subcourses: [
                            { id: 'c1', title: 'Sistema Locomotor', duration: '20h', type: 'Video + PDF' },
                            { id: 'c2', title: 'Neuroanatomia', duration: '35h', type: 'Video + PDF' },
                            { id: 'c3', title: 'Esplancnologia', duration: '15h', type: 'Video + PDF' },
                            { id: 'c4', title: 'Anatomia Topográfica', duration: '25h', type: 'Video + PDF' },
                        ]
                    },
                    {
                        id: 'fisio', title: 'Fisiologia', color: 'from-blue-500 to-blue-700',
                        subcourses: [ { id: 'c5', title: 'Fisiologia Cardiovascular', duration: '12h', type: 'Video' } ]
                    },
                    {
                        id: 'hist', title: 'Histologia', color: 'from-violet-500 to-violet-700',
                        subcourses: [ { id: 'c7', title: 'Tecidos Básicos', duration: '10h', type: 'PDF' } ]
                    },
                    {
                        id: 'bioq', title: 'Bioquímica', color: 'from-orange-500 to-orange-700',
                        subcourses: [ { id: 'c8', title: 'Metabolismo', duration: '18h', type: 'Video' } ]
                    },
                ]
            },
            clinico: {
                title: "Ciclo Clínico",
                icon: <Stethoscope size={20} />,
                subjects: [
                    {
                        id: 'semio', title: 'Semiologia Médica', color: 'from-cyan-500 to-cyan-700',
                        subcourses: [ 
                            { id: 'c9', title: 'Exame Físico Geral', duration: '10h', type: 'Prática' },
                            { id: 'c10', title: 'Anamnese Completa', duration: '5h', type: 'Teoria' }
                        ]
                    },
                    {
                        id: 'cardio', title: 'Cardiologia', color: 'from-red-500 to-red-700',
                        subcourses: [ { id: 'c11', title: 'ECG para Iniciantes', duration: '8h', type: 'Curso' } ]
                    },
                    {
                        id: 'pneumo', title: 'Pneumologia', color: 'from-sky-500 to-sky-700',
                        subcourses: [ { id: 'c13', title: 'Doenças Obstrutivas', duration: '9h', type: 'Video' } ]
                    },
                ]
            },
            internato: {
                title: "Internato",
                icon: <Activity size={20} />,
                subjects: [
                    {
                        id: 'urg', title: 'Urgência e Emergência', color: 'from-rose-600 to-rose-800',
                        subcourses: [ 
                            { id: 'c14', title: 'Protocolo de ACLS', duration: '10h', type: 'Simulação' },
                            { id: 'c15', title: 'Trauma (ATLS)', duration: '15h', type: 'Simulação' }
                        ]
                    },
                    {
                        id: 'cir', title: 'Cirurgia Geral', color: 'from-slate-500 to-slate-700',
                        subcourses: [ { id: 'c16', title: 'Clínica Cirúrgica', duration: '20h', type: 'Video' } ]
                    },
                    {
                        id: 'go', title: 'Ginecologia e Obstetrícia', color: 'from-pink-500 to-pink-700',
                        subcourses: [ { id: 'c17', title: 'Pré-Natal', duration: '12h', type: 'Video' } ]
                    },
                ]
            },
            pbl_basico: {
                title: "Tutoria – Ciclo Básico",
                icon: <Users size={20} />,
                subjects: [
                    { 
                        id: 'mod1', 
                        title: 'Módulo 1 — Introdução ao Estudo da Medicina', 
                        color: 'from-amber-600 to-amber-800', 
                        subcourses: [{id: 'm1c1', title: 'Problema 1: O Início', type: 'PBL'}, {id: 'm1c2', title: 'Problema 2: SUS', type: 'PBL'}],
                        problems: [
                            { id: 'p1', title: 'Problema 1: O Início', file: 'Módulo I – Introdução ao Estudo da Medicina.html' }
                        ],
                        questions: []
                    },
                    { id: 'mod2', title: 'Módulo 2 — Alteração, Proliferação e Crescimento Celular', color: 'from-amber-600 to-amber-800', subcourses: [{id: 'm2c1', title: 'Conteúdo do Módulo', type: 'PBL'}], problems: [], questions: [] },
                    { id: 'mod3', title: 'Módulo 3 — Funções Biológicas 1', color: 'from-amber-600 to-amber-800', subcourses: [{id: 'm3c1', title: 'Conteúdo do Módulo', type: 'PBL'}], problems: [], questions: [] },
                    { 
                        id: 'mod4', 
                        title: 'Módulo 4 — Funções Biológicas 2', 
                        color: 'from-amber-600 to-amber-800', 
                        subcourses: [{id: 'm4c1', title: 'Conteúdo do Módulo', type: 'PBL'}], 
                        problems: [
                            { id: 'm4_p1', title: 'Problema 1 - Apostila Neurofisiologia e Alcool', file: '/Tutoria/Resumos/Módulo 4/Problema 1 - Apostila_Neurofisiologia_e_Alcool.html', moduleRef: '4' },
                            { id: 'm4_p2', title: 'Problema 2 - Apostila Controlo Motor', file: '/Tutoria/Resumos/Módulo 4/Problema 2 - Apostila_Controlo_Motor.html', moduleRef: '4' },
                            { id: 'm4_p3', title: 'Problema 3 - Apostila Sistema Endocrino', file: '/Tutoria/Resumos/Módulo 4/Problema 3 - Apostila_Sistema_Endocrino.html', moduleRef: '4' },
                            { id: 'm4_p4', title: 'Problema 4 - Apostila Fisiologia Renal', file: '/Tutoria/Resumos/Módulo 4/Problema 4 - Apostila_Fisiologia_Renal.html', moduleRef: '4' }
                        ], 
                        questions: [] 
                    },
                    { id: 'mod5', title: 'Módulo 5 — Metabolismo e Nutrição', color: 'from-amber-600 to-amber-800', subcourses: [{id: 'm5c1', title: 'Conteúdo do Módulo', type: 'PBL'}], problems: [], questions: [] },
                    { 
                        id: 'mod6', 
                        title: 'Módulo 6 — Mecanismo de Agressão e Defesa', 
                        color: 'from-amber-600 to-amber-800', 
                        subcourses: [{id: 'm6c1', title: 'Conteúdo do Módulo', type: 'PBL'}],
                        simulados: [
                            { id: 'sim1', title: 'Simulado TUT – P1', file: 'tutoria/Módulo 6 - Mecanismo de Agressão e Defesa/Simulado_TUT_P1.html' },
                            { id: 'sim2', title: 'Simulado TUT – P2', file: 'tutoria/Módulo 6 - Mecanismo de Agressão e Defesa/Simulado_TUT_P2.html' },
                            { id: 'sim3', title: 'Simulado TUT – P3', file: 'tutoria/Módulo 6 - Mecanismo de Agressão e Defesa/Simulado_TUT_P3.html' },
                            { id: 'sim4', title: 'Simulado TUT – P4', file: 'tutoria/Módulo 6 - Mecanismo de Agressão e Defesa/Simulado_TUT_P4.html' },
                            { id: 'sim5', title: 'Simulado TUT – P5', file: 'tutoria/Módulo 6 - Mecanismo de Agressão e Defesa/Simulado_TUT_P5.html' },
                            { id: 'sim6', title: 'Simulado TUT – P6', file: 'tutoria/Módulo 6 - Mecanismo de Agressão e Defesa/Simulado_TUT_P6.html' }
                        ],
                        problems: [
                            { 
                                id: 'p1', 
                                title: 'Problema 1 – MECANISMO DE AGRESSÃO E DEFESA', 
                                file: '/Tutoria/Resumos/Módulo 6/Problema 1 – MECANISMO DE AGRESSÃO E DEFESA.html',
                                moduleRef: '6'
                            },
                            { 
                                id: 'p2', 
                                title: 'Problema 2 – Termos, Defesas e Hipersensibilidade', 
                                file: '/Tutoria/Resumos/Módulo 6/Problema 2 - Termos, Defesas e Hipersensibilidade.html',
                                moduleRef: '6'
                            },
                            { 
                                id: 'p3', 
                                title: 'Problema 3 – Mecanismos de Agressão e Defesa, Bactérias, Imunidade e Evasão Imune', 
                                file: '/Tutoria/Resumos/Módulo 6/Problema 3 - Mecanismos de Agressão e Defesa, Bactérias, Imunidade e Evasão Imune.html',
                                moduleRef: '6'
                            },
                            { 
                                id: 'p4', 
                                title: 'Problema 4 – Patologia e Terapêutica', 
                                file: '/Tutoria/Resumos/Módulo 6/Problema 4 - Patologia e Terapêutica.html',
                                moduleRef: '6'
                            },
                            { 
                                id: 'p5', 
                                title: 'Problema 5 – Reparação Tecidual e Estresse Oxidativo', 
                                file: '/Tutoria/Resumos/Módulo 6/Problema 5 - Reparação Tecidual e Estresse Oxidativo.html',
                                moduleRef: '6'
                            },
                            { 
                                id: 'p6', 
                                title: 'Problema 6 – Parasitologia e Imunomodulação', 
                                file: '/Tutoria/Resumos/Módulo 6/Problema 6 - Parasitologia e Imunomodulação.html',
                                moduleRef: '6'
                            }
                        ],
                        questions: [
                            { 
                                id: 'q1', 
                                title: 'ATP1M6', 
                                file: 'tutoria/Módulo 6 - Mecanismo de Agressão e Defesa/ATP1M6.html',
                                moduleRef: '6'
                            },
                            { 
                                id: 'q2', 
                                title: 'ATP2M6', 
                                file: 'tutoria/Módulo 6 - Mecanismo de Agressão e Defesa/ATP2M6.html',
                                moduleRef: '6'
                            },
                            { 
                                id: 'q3', 
                                title: 'ATP3M6', 
                                file: 'tutoria/Módulo 6 - Mecanismo de Agressão e Defesa/ATP3M6.html',
                                moduleRef: '6'
                            },
                            { 
                                id: 'q4', 
                                title: 'ATP4M6', 
                                file: 'tutoria/Módulo 6 - Mecanismo de Agressão e Defesa/ATP4M6.html',
                                moduleRef: '6'
                            },
                            { 
                                id: 'q5', 
                                title: 'ATP5M6', 
                                file: 'tutoria/Módulo 6 - Mecanismo de Agressão e Defesa/ATP5M6.html',
                                moduleRef: '6'
                            },
                            { 
                                id: 'q6', 
                                title: 'ATP6M6', 
                                file: 'tutoria/Módulo 6 - Mecanismo de Agressão e Defesa/ATP6M6.html',
                                moduleRef: '6'
                            }
                        ]
                    },
                    { 
                        id: 'mod7', 
                        title: 'Módulo 7 — Concepção, Formação do Ser Humano e Gestação', 
                        color: 'from-amber-600 to-amber-800', 
                        subcourses: [
                            {id: 'm7c1', title: 'Conteúdo do Módulo', type: 'PBL'},
                            {
                                id: 'm7_reprodutor',
                                title: 'Sistema Reprodutor',
                                type: 'Módulo de Aulas',
                                lessons: REPRODUTOR_LESSONS 
                            }
                        ],
                        problems: [
                            { id: 'm7_a1', title: 'APOSTILA SAÚDE REPRODUTIVA E PLAN', file: '/Tutoria/Resumos/Módulo 7/1. APOSTILA SAÚDE REPRODUTIVA E PLAN.html', moduleRef: '7' },
                            { id: 'm7_a2', title: 'Apostila_Embriologia_e_Abortamento', file: '/Tutoria/Resumos/Módulo 7/2. Apostila_Embriologia_e_Abortamento.html', moduleRef: '7' },
                            { id: 'm7_a3', title: 'Apostila_Pre_Natal_e_Parto', file: '/Tutoria/Resumos/Módulo 7/3. Apostila_Pre_Natal_e_Parto.html', moduleRef: '7' },
                            { id: 'm7_a4', title: 'Apostila_Mecanismo_de_Parto', file: '/Tutoria/Resumos/Módulo 7/4. Apostila_Mecanismo_de_Parto.html', moduleRef: '7' },
                            { id: 'm7_a5', title: 'Apostila_Puerperio_e_Lactacao', file: '/Tutoria/Resumos/Módulo 7/5. Apostila_Puerperio_e_Lactacao.html', moduleRef: '7' }
                        ],
                        questions: []
                    },
                    { 
                        id: 'mod8', 
                        title: 'Módulo 8 — Crescimento e Desenvolvimento da Criança', 
                        color: 'from-amber-600 to-amber-800', 
                        subcourses: [{id: 'm8c1', title: 'Conteúdo do Módulo', type: 'PBL'}],
                        
                        // --- ESTRUTURA PARA MÓDULO 8 (ATUALIZADO) ---
                        problems: [
                            { id: 'm8_p1', title: 'Apostila Neonatologia - Sala de Parto', file: '/Tutoria/Resumos/Módulo 8/1. Apostila_Neonatologia_Sala_de_Parto.html', moduleRef: '8' },
                            { id: 'm8_p2', title: 'Apostila Icterícia e Imunologia', file: '/Tutoria/Resumos/Módulo 8/2. Apostila_Ictericia_e_Imunologia.html', moduleRef: '8' },
                            { id: 'm8_p3', title: 'Apostila Nutrição e Vacinação', file: '/Tutoria/Resumos/Módulo 8/3. Apostila_Nutricao_e_Vacinacao.html', moduleRef: '8' },
                            { id: 'm8_p4', title: 'Apostila Desenvolvimento Infantil', file: '/Tutoria/Resumos/Módulo 8/4. Apostila_Desenvolvimento_Infantil.html', moduleRef: '8' },
                            { id: 'm8_p5', title: 'Apostila Obesidade e Puberdade', file: '/Tutoria/Resumos/Módulo 8/5. Apostila_Obesidade_e_Puberdade.html', moduleRef: '8' },
                            { id: 'm8_p6', title: 'Apostila Hebiatria', file: '/Tutoria/Resumos/Módulo 8/6. Apostila_Hebiatra.html', moduleRef: '8' }
                        ],
                        questions: []
                    },
                    { 
                        id: 'mod9', 
                        title: 'Módulo 9 — Vida Adulta e Processo de Envelhecimento', 
                        color: 'from-amber-600 to-amber-800', 
                        subcourses: [{id: 'm9c1', title: 'Conteúdo do Módulo', type: 'PBL'}],
                        problems: [
                            { id: 'm9_p1', title: 'Apostila Envelhecimento', file: '/Tutoria/Resumos/Módulo 9/1. Apostila_Envelhecimento.html', moduleRef: '9' },
                            { id: 'm9_p2', title: 'Apostila Neuro Osteo Geriatria', file: '/Tutoria/Resumos/Módulo 9/2. Apostila_Neuro_Osteo_Geriatria.html', moduleRef: '9' },
                            { id: 'm9_p3', title: 'Apostila Iatrogenia e Rim Geriátrico', file: '/Tutoria/Resumos/Módulo 9/3. Apostila_Iatrogenia_e_Rim_Geriatrico.html', moduleRef: '9' },
                            { id: 'm9_p4', title: 'Apostila Manutenção Saúde Idoso', file: '/Tutoria/Resumos/Módulo 9/4. Apostila_Manutencao_Saude_Idoso.html', moduleRef: '9' },
                            { id: 'm9_p5', title: 'Apostila Bioética e Fisiopatologia Geriátrica', file: '/Tutoria/Resumos/Módulo 9/5. Apostila_Bioetica_e_Fisiopatologia_Geri.html', moduleRef: '9' }
                        ],
                        questions: []
                    },
                    { id: 'mod10', title: 'Módulo 10 — Percepção, Consciência e Emoções', color: 'from-amber-600 to-amber-800', subcourses: [{id: 'm10c1', title: 'Conteúdo do Módulo', type: 'PBL'}], problems: [], questions: [] },
                    { id: 'mod11', title: 'Módulo 11 — Febre, Inflamação e Infecção', color: 'from-amber-600 to-amber-800', subcourses: [{id: 'm11c1', title: 'Conteúdo do Módulo', type: 'PBL'}], problems: [], questions: [] },
                    { id: 'mod12', title: 'Módulo 12 — Fadiga, Perda de Peso e Anemias', color: 'from-amber-600 to-amber-800', subcourses: [{id: 'm12c1', title: 'Conteúdo do Módulo', type: 'PBL'}], problems: [], questions: [] },
                ]
            },
            pbl_clinico: {
                title: "Tutoria – Ciclo Clínico",
                icon: <Users size={20} />,
                subjects: [
                    { id: 'mod13', title: 'Módulo 13 — Disúria, Edema e Proteinúria', color: 'from-cyan-600 to-cyan-800', subcourses: [{id: 'm13c1', title: 'Conteúdo do Módulo', type: 'PBL'}], problems: [], questions: [] },
                    { id: 'mod14', title: 'Módulo 14 — Perda de Sangue', color: 'from-cyan-600 to-cyan-800', subcourses: [{id: 'm14c1', title: 'Conteúdo do Módulo', type: 'PBL'}], problems: [], questions: [] },
                    { id: 'mod15', title: 'Módulo 15 — Mente e Comportamento', color: 'from-cyan-600 to-cyan-800', subcourses: [{id: 'm15c1', title: 'Conteúdo do Módulo', type: 'PBL'}], problems: [], questions: [] },
                    { id: 'mod16', title: 'Módulo 16 — Doenças Prevalentes na Amazônia', color: 'from-cyan-600 to-cyan-800', subcourses: [{id: 'm16c1', title: 'Conteúdo do Módulo', type: 'PBL'}], problems: [], questions: [] },
                    { id: 'mod17', title: 'Módulo 17 — Dor Abdominal, Diarreia, Vômito e Icterícia', color: 'from-cyan-600 to-cyan-800', subcourses: [{id: 'm17c1', title: 'Conteúdo do Módulo', type: 'PBL'}], problems: [], questions: [] },
                    { id: 'mod18', title: 'Módulo 18 — Sinais e Sintomas Dermatológicos', color: 'from-cyan-600 to-cyan-800', subcourses: [{id: 'm18c1', title: 'Conteúdo do Módulo', type: 'PBL'}], problems: [], questions: [] },
                    { 
                        id: 'more_clinico', 
                        title: 'Mais Módulos em Breve...', 
                        color: 'from-slate-700 to-slate-800', 
                        isPlaceholder: true, 
                        subcourses: [],
                        problems: [], questions: []
                    },
                ]
            },
            pbl: {
                title: "PBL & Casos",
                icon: <Users size={20} />,
                subjects: [
                    {
                        id: 'skills', title: 'Habilidades Médicas', color: 'from-teal-500 to-teal-700',
                        subcourses: [ { id: 's1', title: 'Suturas', duration: 'Prática', type: 'Lab' } ], problems: [], questions: []
                    }
                ]
            }
        };

        // --- UTILS DE PESQUISA ---
        const searchDatabase = (query, dataObj) => {
            if (!query || query.length < 2) return [];
            const term = query.toLowerCase();
            let results = [];

            const processSubjects = (sectionTitle, subjects) => {
                subjects.forEach(sub => {
                    // Busca no título do módulo
                    if (sub.title.toLowerCase().includes(term)) {
                        results.push({
                            type: 'Módulo',
                            title: sub.title,
                            subtitle: sectionTitle,
                            action: 'module',
                            data: sub,
                            path: null
                        });
                    }

                    // Busca nos Problemas (Resumos)
                    if (sub.problems) {
                        sub.problems.forEach(prob => {
                            if (prob.title.toLowerCase().includes(term)) {
                                results.push({
                                    type: 'Resumo',
                                    title: prob.title,
                                    subtitle: sub.title,
                                    action: 'link',
                                    path: prob.file,
                                    moduleId: sub.id
                                });
                            }
                        });
                    }

                    // Busca nas Questões (ATP)
                    if (sub.questions) {
                        sub.questions.forEach(quest => {
                            if (quest.title.toLowerCase().includes(term)) {
                                results.push({
                                    type: 'Questão',
                                    title: quest.title,
                                    subtitle: sub.title,
                                    action: 'link',
                                    path: quest.file,
                                    moduleId: sub.id
                                });
                            }
                        });
                    }
                });
            };

            // Percorre todas as categorias do DATA
            Object.values(dataObj).forEach(category => {
                // Tratamento especial para as plataformas
                if (category.sanar && category.emr) {
                    processSubjects('Plataforma', [category.sanar, category.emr]);
                } else if (category.subjects) {
                    processSubjects(category.title, category.subjects);
                }
            });

            return results;
        };

        // --- COMPONENTES ---

        // CARD ESTILO MEDNEXUS (RETANGULAR SÓLIDO - COMPACTO & MINIMALISTA)
        const CourseCard = ({ subject, onClick }) => (
            <div 
                onClick={() => onClick(subject)}
                data-title={subject.title}
                data-module={subject.id}
                className={`flex-shrink-0 w-52 h-32 mr-3 rounded-lg cursor-pointer relative overflow-hidden group transition-all duration-300 hover:scale-[1.03] hover:shadow-lg shadow-black/50 ${subject.isPlaceholder ? 'border-2 border-dashed border-slate-700' : ''}`}
            >
                {/* Background */}
                {subject.image ? (
                    <div className="absolute inset-0">
                        <img src={subject.image} alt="" className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" />
                        <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent"></div>
                    </div>
                ) : (
                    <div className={`absolute inset-0 bg-gradient-to-br ${subject.color || 'from-slate-700 to-slate-800'} opacity-100`}></div>
                )}
                
                {/* Textura sutil para cards sem imagem */}
                {!subject.isPlaceholder && !subject.image && (
                    <div className="absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-white to-transparent"></div>
                )}

                {/* Conteúdo: Apenas Título na parte inferior */}
                <div className="absolute inset-0 p-4 flex flex-col justify-end z-10">
                    {subject.isPlaceholder ? (
                        <div className="flex flex-col items-center justify-center h-full text-slate-500">
                            <PlusCircle size={24} className="mb-2" />
                            <span className="text-xs font-medium text-center">Adicionar</span>
                        </div>
                    ) : (
                        // Conditional rendering: Show title only if NO image
                        !subject.image && (
                            <h3 className="text-sm font-bold text-white leading-tight drop-shadow-md group-hover:text-slate-100">
                                {subject.title}
                            </h3>
                        )
                    )}
                </div>
            </div>
        );

        // --- CARROUSEL COM LOGO/ÍCONE DA SEÇÃO ---
        const CarouselSection = ({ title, icon, subjects, onSubjectClick }) => {
            const scrollRef = useRef(null);
            
            const scroll = (direction) => {
                if (scrollRef.current) {
                    const scrollAmount = 300;
                    scrollRef.current.scrollBy({ left: direction === 'left' ? -scrollAmount : scrollAmount, behavior: 'smooth' });
                }
            };

            return (
                <div className="mb-10 group/carousel relative" data-section={title}>
                    <div className="flex items-center justify-between mb-4 px-2">
                        <div className="flex items-center gap-3">
                            {/* Logo da Seção */}
                            {icon && (
                                <div className="w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center border border-slate-700 shadow-lg">
                                    <span className="text-blue-500">
                                        {React.cloneElement(icon, { size: 22 })}
                                    </span>
                                </div>
                            )}
                            
                            <h2 className="text-xl font-bold text-slate-100 group-hover/carousel:text-white transition-colors cursor-pointer">
                                {title}
                            </h2>
                        </div>
                        
                        <div className="flex gap-2">
                            <button onClick={() => scroll('left')} className="p-2 rounded-full bg-slate-800 hover:bg-slate-700 text-slate-300 transition-colors"><ChevronLeft size={16} /></button>
                            <button onClick={() => scroll('right')} className="p-2 rounded-full bg-slate-800 hover:bg-slate-700 text-slate-300 transition-colors"><ChevronRight size={16} /></button>
                        </div>
                    </div>
                    
                    <div 
                        ref={scrollRef} 
                        className="flex gap-2 overflow-x-auto pb-4 scrollbar-hide scroll-smooth px-1"
                        style={{ scrollbarWidth: 'none' }}
                    >
                        {subjects.map((subject) => (
                            <CourseCard key={subject.id} subject={subject} onClick={onSubjectClick} />
                        ))}
                        <div className="w-4 flex-shrink-0" />
                    </div>
                </div>
            );
        };

        // --- COMPONENTE COURSE PLAYER (ATUALIZADO) ---
        // Adicionada prop 'parentTitle' para flexibilidade no breadcrumb
        const CoursePlayer = ({ course, onBack, currentLessonIndex, setCurrentLessonIndex, parentTitle = "SanarFlix" }) => {
            const currentLesson = course.lessons[currentLessonIndex];
            const hasNextLesson = currentLessonIndex < course.lessons.length - 1;

            const handleNext = () => {
                if (hasNextLesson) {
                    setCurrentLessonIndex(prev => prev + 1);
                    // Scroll to top of video
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            };

            return (
                <div className="animate-fade-in pb-20">
                     {/* Header de Navegação */}
                     <div className="mb-6 flex items-center gap-2 text-sm text-slate-400">
                        <span className="cursor-pointer hover:text-white" onClick={onBack}>{parentTitle}</span>
                        <ChevronRight size={14} />
                        <span className="text-white font-medium truncate">{course.title}</span>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        {/* Área do Player (Esquerda/Topo) */}
                        <div className="lg:col-span-2 space-y-4">
                            <div className="w-full aspect-video bg-black rounded-2xl overflow-hidden shadow-2xl border border-slate-800">
                                <iframe 
                                    className="w-full h-full"
                                    src={`https://www.youtube.com/embed/${currentLesson.videoId}?rel=0`}
                                    title={currentLesson.title}
                                    frameBorder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowFullScreen
                                ></iframe>
                            </div>
                            
                            <div className="flex justify-between items-start">
                                <div>
                                    <h1 className="text-2xl font-bold text-white mb-2">{currentLesson.title}</h1>
                                    <p className="text-slate-400 text-sm">Aula {currentLessonIndex + 1} de {course.lessons.length}</p>
                                </div>
                                {hasNextLesson && (
                                    <button 
                                        onClick={handleNext}
                                        className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-full font-bold transition-all hover:scale-105 shadow-lg shadow-blue-900/50"
                                    >
                                        Próxima Aula <ChevronRight size={18} />
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* Lista de Aulas (Direita/Sidebar) */}
                        <div className="bg-slate-800/50 border border-slate-700 rounded-2xl overflow-hidden h-fit max-h-[calc(100vh-150px)] flex flex-col">
                            <div className="p-4 border-b border-slate-700 bg-slate-800">
                                <h3 className="font-bold text-white flex items-center gap-2">
                                    <ListVideo size={18} className="text-blue-500" />
                                    Conteúdo do Módulo
                                </h3>
                                <div className="w-full bg-slate-700 h-1.5 mt-3 rounded-full overflow-hidden">
                                    <div 
                                        className="bg-blue-500 h-full rounded-full transition-all duration-500"
                                        style={{ width: `${((currentLessonIndex + 1) / course.lessons.length) * 100}%` }}
                                    ></div>
                                </div>
                                <p className="text-xs text-slate-400 mt-1 text-right">{Math.round(((currentLessonIndex + 1) / course.lessons.length) * 100)}% Concluído</p>
                            </div>
                            
                            <div className="overflow-y-auto p-2 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent flex-1">
                                {course.lessons.map((lesson, idx) => {
                                    const isActive = idx === currentLessonIndex;
                                    const isCompleted = idx < currentLessonIndex;

                                    return (
                                        <div 
                                            key={idx}
                                            onClick={() => setCurrentLessonIndex(idx)}
                                            className={`p-3 rounded-xl mb-1 cursor-pointer transition-all flex items-start gap-3 group ${isActive ? 'bg-blue-600/20 border border-blue-500/50' : 'hover:bg-slate-700/50 border border-transparent'}`}
                                        >
                                            <div className="mt-1">
                                                {isActive ? (
                                                    <div className="w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center shadow-lg shadow-blue-500/50">
                                                        <Play size={10} className="text-white ml-0.5" fill="currentColor" />
                                                    </div>
                                                ) : isCompleted ? (
                                                    <CheckCircle2 size={20} className="text-green-500" />
                                                ) : (
                                                    <div className="w-5 h-5 rounded-full border-2 border-slate-600 flex items-center justify-center text-[10px] text-slate-500 font-bold group-hover:border-slate-400 group-hover:text-slate-400">
                                                        {idx + 1}
                                                    </div>
                                                )}
                                            </div>
                                            <div className="flex-1">
                                                <h4 className={`text-sm font-medium leading-tight ${isActive ? 'text-blue-100' : 'text-slate-400 group-hover:text-slate-200'}`}>
                                                    {lesson.title}
                                                </h4>
                                                <span className="text-[10px] text-slate-600 mt-1 block">Vídeo Aula</span>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // --- COMPONENTE BANNER PLATAFORMA ---
        const PlatformBanner = ({ title, subtitle, color, icon, theme, image, onClick }) => {
            const gradients = theme === 'red' 
                ? 'from-red-700 via-red-800 to-red-950 border-red-500/20 hover:border-red-500/50' 
                : 'from-emerald-700 via-emerald-800 to-emerald-950 border-emerald-500/20 hover:border-emerald-500/50';
            
            const glowColor = theme === 'red' ? 'bg-red-600/20' : 'bg-emerald-600/20';
            const iconBg = theme === 'red' ? 'text-red-700' : 'text-emerald-700';
            const shadowColor = theme === 'red' ? 'shadow-red-900/50' : 'shadow-emerald-900/50';
            const subTextColor = theme === 'red' ? 'text-red-200' : 'text-emerald-200';
            const btnHoverText = theme === 'red' ? 'hover:text-red-700' : 'hover:text-emerald-700';

            return (
                <div 
                    onClick={onClick}
                    className={`w-full h-64 bg-gradient-to-br ${gradients} rounded-2xl relative overflow-hidden cursor-pointer group shadow-2xl shadow-black/50 border transition-all hover:scale-[1.01]`}
                >
                     {/* Imagem de Fundo (Se existir) */}
                     {image ? (
                        <div className="absolute inset-0">
                            <img 
                                src={image} 
                                alt={title} 
                                className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" 
                                style={{ objectPosition: 'center' }}
                            />
                        </div>
                     ) : (
                         /* Fundo Padrão (Sem imagem) */
                         <>
                             <div className={`absolute top-0 right-0 w-[400px] h-[400px] ${theme === 'red' ? 'bg-red-600/20' : 'bg-emerald-600/20'} rounded-full blur-[100px] -translate-y-1/2 translate-x-1/4`}></div>
                             <div className="absolute bottom-0 left-0 w-[200px] h-[200px] bg-black/40 rounded-full blur-[60px] translate-y-1/4 -translate-x-1/4"></div>
                             <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.03)_1px,transparent_1px)] bg-[size:40px_40px]"></div>
                         </>
                     )}

                     <div className="absolute inset-0 flex flex-col justify-end p-8 relative z-10">
                        {/* Exibe Título/Subtítulo apenas se NÃO tiver imagem */}
                        {!image && (
                            <div className="flex items-center gap-4 mb-3">
                                <div className={`p-3 bg-white ${iconBg} rounded-xl shadow-lg ${shadowColor} group-hover:scale-110 transition-transform duration-300`}>
                                    {icon}
                                </div>
                                <div>
                                    <span className={`${subTextColor} font-bold tracking-widest text-xs uppercase mb-1 block`}>{subtitle}</span>
                                    <h3 className="text-2xl md:text-3xl font-bold text-white tracking-tight">{title}</h3>
                                </div>
                            </div>
                        )}
                        
                        <div className="flex justify-between items-end mt-4">
                            <div className="w-full">
                                <button className={`flex items-center gap-2 bg-white/10 hover:bg-white text-white ${btnHoverText} px-5 py-2.5 rounded-full font-bold text-sm transition-all backdrop-blur-md border border-white/20 group-hover:border-white w-fit`}>
                                    Acessar <ChevronRight size={16} />
                                </button>
                            </div>
                        </div>
                     </div>
                </div>
            );
        };
        
        // --- NOVO COMPONENTE: SANARFLIX STYLE (PRIME VIDEO LAYOUT) ---
        const SanarflixSection = ({ onSubjectClick, subjects }) => {
            // Estado para busca interna do SanarFlix
            const [searchTerm, setSearchTerm] = useState('');
            
            const scrollRef1 = useRef(null);
            const scrollRef2 = useRef(null);
            const scrollRef3 = useRef(null);

            // Filtra os cursos com base na busca interna
            const filteredSubjects = subjects.filter(subject => 
                subject.title.toLowerCase().includes(searchTerm.toLowerCase())
            );

            // Função auxiliar para rolar os carrosséis
            const scroll = (ref, direction) => {
                if (ref.current) {
                    const scrollAmount = 600;
                    ref.current.scrollBy({ left: direction === 'left' ? -scrollAmount : scrollAmount, behavior: 'smooth' });
                }
            };

            // Divide os cursos em categorias fictícias para simular o layout do Prime Video
            const featuredCourses = subjects.slice(0, 8);
            const newCourses = subjects.slice(8, 16);
            const allCourses = subjects.slice(16);

            const SanarCard = ({ subject }) => {
                const hasLessons = subject.lessons && subject.lessons.length > 0;
                return (
                    <div 
                        onClick={() => onSubjectClick(subject)}
                        className="flex-shrink-0 w-[280px] h-[150px] relative rounded-lg cursor-pointer overflow-hidden group transition-all duration-300 hover:scale-105 hover:z-10 hover:shadow-2xl hover:shadow-red-900/40 border border-slate-700/50 hover:border-red-500"
                    >
                        {/* Fundo Gradiente Estilo Sanar */}
                        <div className="absolute inset-0 bg-gradient-to-br from-slate-900 via-slate-800 to-[#2a0a0a] group-hover:from-red-950 group-hover:via-red-900 group-hover:to-red-800 transition-colors duration-500"></div>
                        
                        {/* Textura sutil */}
                        <div className="absolute inset-0 opacity-20 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-red-500/20 to-transparent"></div>

                        {/* Conteúdo do Card */}
                        <div className="absolute inset-0 p-5 flex flex-col justify-between z-10">
                            <h3 className="text-base font-bold text-slate-100 leading-snug line-clamp-2 group-hover:text-white drop-shadow-md">
                                {subject.title}
                            </h3>
                            
                            <div className="flex items-center justify-between mt-auto">
                                <div className="flex items-center gap-2">
                                    <span className="text-[10px] font-bold tracking-wider uppercase text-slate-400 bg-black/30 px-2 py-1 rounded border border-white/10 group-hover:bg-white/20 group-hover:text-white transition-colors">
                                        {subject.duration || 'CURSO'}
                                    </span>
                                </div>
                                {hasLessons ? (
                                    <PlayCircle size={20} className="text-red-500 group-hover:text-white transition-colors drop-shadow-lg" />
                                ) : (
                                    <Lock size={16} className="text-slate-600 group-hover:text-red-200" />
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const CarouselRow = ({ title, items, scrollRef }) => (
                <div className="mb-10 group/row">
                    <div className="flex items-center justify-between mb-3 px-2">
                        <h3 className="text-lg font-bold text-slate-100 flex items-center gap-2">
                            {title} <ChevronRight size={16} className="text-slate-500" />
                        </h3>
                    </div>
                    
                    <div className="relative">
                        {/* Botão Scroll Esquerda */}
                        <button 
                            onClick={() => scroll(scrollRef, 'left')}
                            className="absolute left-0 top-0 bottom-0 w-12 bg-gradient-to-r from-black/80 to-transparent z-20 flex items-center justify-center opacity-0 group-hover/row:opacity-100 transition-opacity duration-300 hover:bg-black/60 text-white"
                        >
                            <ChevronLeft size={32} />
                        </button>

                        {/* Container Scroll */}
                        <div 
                            ref={scrollRef} 
                            className="flex gap-4 overflow-x-auto pb-4 scrollbar-hide scroll-smooth px-2"
                            style={{ scrollbarWidth: 'none' }}
                        >
                            {items.map((subject) => (
                                <SanarCard key={subject.id} subject={subject} />
                            ))}
                            {/* Espaçador final */}
                            <div className="w-8 flex-shrink-0" />
                        </div>

                        {/* Botão Scroll Direita */}
                        <button 
                            onClick={() => scroll(scrollRef, 'right')}
                            className="absolute right-0 top-0 bottom-0 w-12 bg-gradient-to-l from-black/80 to-transparent z-20 flex items-center justify-center opacity-0 group-hover/row:opacity-100 transition-opacity duration-300 hover:bg-black/60 text-white"
                        >
                            <ChevronRight size={32} />
                        </button>
                    </div>
                </div>
            );

            return (
                <div className="animate-fade-in -mt-4">
                    {/* Header estilo "Hero" reduzido com Busca */}
                    <div className="mb-8 p-6 rounded-2xl bg-gradient-to-r from-red-900 to-black border border-red-900/30 flex flex-col md:flex-row md:items-center justify-between gap-4 shadow-2xl">
                        <div className="flex items-center gap-4">
                            {/* IMAGEM DE CAPA DO SANARFLIX - MANTIDA */}
                            <div className="relative w-full h-40 md:h-32 rounded-xl overflow-hidden shadow-lg border border-red-500/20">
                                <img src="Tutoria/sanarflix/Sanar.png" className="w-full h-full object-cover" alt="SanarFlix" />
                                <div className="absolute inset-0 bg-gradient-to-r from-black/60 to-transparent"></div>
                                <div className="absolute bottom-4 left-4">
                                     <button className="flex items-center gap-2 bg-white/10 hover:bg-white text-white hover:text-red-700 px-5 py-2.5 rounded-full font-bold text-sm transition-all backdrop-blur-md border border-white/20 group-hover:border-white w-fit">
                                        Acessar <ChevronRight size={16} />
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Busca Interna SanarFlix */}
                        <div className="relative w-full md:w-96 group mt-4 md:mt-0">
                            <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-red-200/50 group-focus-within:text-red-400 transition-colors" size={18} />
                            <input 
                                type="text" 
                                placeholder="Buscar cursos no SanarFlix..." 
                                className="w-full bg-black/40 border border-red-500/30 rounded-full py-2.5 pl-10 pr-10 text-sm text-red-100 placeholder-red-200/30 focus:outline-none focus:border-red-500/60 focus:bg-black/60 transition-all shadow-inner"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            {searchTerm && (
                                <button onClick={() => setSearchTerm('')} className="absolute right-3 top-1/2 -translate-y-1/2 text-red-200/50 hover:text-white transition-colors">
                                    <X size={16} />
                                </button>
                            )}
                        </div>
                    </div>

                    {/* Lógica de Exibição: Resultados da Busca VS Carrosséis */}
                    {searchTerm ? (
                        <div className="animate-fade-in px-2">
                            <h3 className="text-lg font-bold text-slate-100 mb-6 flex items-center gap-2">
                                <Search size={20} className="text-red-500" />
                                Resultados para "{searchTerm}"
                                <span className="text-slate-500 text-sm font-normal ml-2">({filteredSubjects.length} encontrados)</span>
                            </h3>
                            
                            {filteredSubjects.length > 0 ? (
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                                    {filteredSubjects.map(subject => (
                                        <SanarCard key={subject.id} subject={subject} />
                                    ))}
                                </div>
                            ) : (
                                <div className="flex flex-col items-center justify-center py-20 text-center border border-dashed border-slate-800 rounded-2xl bg-slate-900/30">
                                    <Search size={48} className="text-slate-700 mb-4" />
                                    <p className="text-slate-400 font-medium text-lg">Nenhum curso encontrado.</p>
                                    <p className="text-slate-600 text-sm">Tente buscar por outro termo.</p>
                                </div>
                            )}
                        </div>
                    ) : (
                        <>
                            <CarouselRow title="Em Alta" items={featuredCourses} scrollRef={scrollRef1} />
                            <CarouselRow title="Novidades na Plataforma" items={newCourses} scrollRef={scrollRef2} />
                            <CarouselRow title="Catálogo Completo" items={allCourses} scrollRef={scrollRef3} />
                        </>
                    )}
                </div>
            );
        };

        // --- COMPONENTE DETALHES DA PLATAFORMA ---
        const PlatformSection = ({ title, subtitle, subjects, theme, onSubjectClick }) => {
            const gradient = theme === 'red' 
                ? 'from-red-900 to-red-950 border-red-800/50' 
                : 'from-emerald-900 to-emerald-950 border-emerald-800/50';
            
            const iconBg = theme === 'red' ? 'bg-red-600 shadow-red-900/50' : 'bg-emerald-600 shadow-emerald-900/50';
            const subTextColor = theme === 'red' ? 'text-red-200' : 'text-emerald-200';
            const cardHover = theme === 'red' 
                ? 'hover:bg-red-600 hover:border-red-500 hover:shadow-red-900/50' 
                : 'hover:bg-emerald-600 hover:border-emerald-500 hover:shadow-emerald-900/50';
            const iconColor = theme === 'red' ? 'text-red-500' : 'text-emerald-500';

            return (
                <div className={`w-full bg-gradient-to-br ${gradient} rounded-2xl p-6 md:p-8 mb-12 shadow-2xl border relative overflow-hidden`}>
                     <div className={`absolute top-0 right-0 w-96 h-96 ${theme === 'red' ? 'bg-red-600/10' : 'bg-emerald-600/10'} rounded-full blur-3xl -translate-y-1/2 translate-x-1/2`}></div>

                     <div className="flex items-center gap-4 mb-6 relative z-10">
                        <div className={`p-3 ${iconBg} rounded-xl text-white shadow-lg`}>
                            {theme === 'red' ? <Play size={28} fill="currentColor" /> : <Stethoscope size={28} />}
                        </div>
                        <div>
                            <h2 className="text-3xl font-bold text-white tracking-tight">{subtitle}</h2>
                            <p className={`${subTextColor} font-medium`}>{title}</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 relative z-10">
                        {subjects.map((subject) => {
                            const hasLessons = subject.lessons && subject.lessons.length > 0;
                            return (
                                <div 
                                    key={subject.id} 
                                    onClick={() => onSubjectClick(subject)}
                                    className={`bg-white/5 border border-white/10 rounded-xl p-4 cursor-pointer transition-all duration-300 group flex flex-col justify-between h-32 hover:-translate-y-1 hover:shadow-xl ${cardHover}`}
                                >
                                    <h3 className="text-sm font-semibold text-white/90 group-hover:text-white line-clamp-3">{subject.title}</h3>
                                    <div className="flex justify-between items-end mt-2">
                                        <span className="text-[10px] uppercase tracking-wider text-white/40 group-hover:text-white/80 font-bold">
                                            {subject.duration}
                                        </span>
                                        {hasLessons ? (
                                             <PlayCircle size={16} className={`${iconColor} group-hover:text-white transition-colors`} />
                                        ) : (
                                             <Lock size={14} className="text-slate-500 group-hover:text-white/50" />
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const NavItem = ({ icon, label, active, onClick }) => (
            <button 
                onClick={onClick}
                className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 ${active ? 'bg-blue-600/10 text-blue-400' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800'}`}
            >
                <span className={active ? 'text-blue-400' : 'text-slate-500 group-hover:text-slate-300'}>{icon}</span>
                <span className="hidden lg:block">{label}</span>
            </button>
        );

        const SearchResults = ({ results, onSelect }) => {
            if (results.length === 0) {
                return (
                    <div className="text-center py-20 animate-fade-in">
                        <Search size={48} className="text-slate-700 mx-auto mb-4" />
                        <h3 className="text-xl font-bold text-slate-400">Nenhum resultado encontrado</h3>
                        <p className="text-slate-600">Tente buscar por termos do módulo, nomes de problemas ou ATPs.</p>
                    </div>
                );
            }

            return (
                <div className="animate-fade-in space-y-4">
                    <h2 className="text-xl font-bold text-white mb-6 flex items-center gap-2">
                        <Search size={20} className="text-blue-500" />
                        Resultados da Busca ({results.length})
                    </h2>
                    <div className="grid grid-cols-1 gap-3">
                        {results.map((item, idx) => (
                            <div 
                                key={idx}
                                onClick={() => onSelect(item)}
                                className="bg-slate-800 border border-slate-700 p-4 rounded-xl cursor-pointer hover:bg-slate-700 hover:border-blue-500/50 transition-all flex items-center justify-between group"
                                data-title={item.title}
                                data-type={item.type.toLowerCase()}
                            >
                                <div className="flex items-center gap-4">
                                    <div className={`p-2 rounded-lg ${
                                        item.type === 'Resumo' ? 'bg-blue-500/10 text-blue-400' : 
                                        item.type === 'Questão' ? 'bg-amber-500/10 text-amber-400' : 
                                        'bg-purple-500/10 text-purple-400'
                                    }`}>
                                        {item.type === 'Resumo' ? <FileText size={20} /> : 
                                         item.type === 'Questão' ? <FileQuestion size={20} /> : 
                                         <BookOpen size={20} />}
                                    </div>
                                    <div>
                                        <h4 className="font-bold text-slate-200 group-hover:text-white">{item.title}</h4>
                                        <p className="text-xs text-slate-500">{item.type} • {item.subtitle}</p>
                                    </div>
                                </div>
                                <ExternalLink size={16} className="text-slate-600 group-hover:text-blue-400 opacity-0 group-hover:opacity-100 transition-all" />
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- APP MAIN ---

        function MedStudyHub() {
            // Função para alternar Tela Cheia
            const toggleFullscreen = () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch((err) => {
                        console.log(`Erro ao tentar ativar tela cheia: ${err.message}`);
                    });
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            };

            const [activeTab, setActiveTab] = useState('dashboard');
            const [selectedSubject, setSelectedSubject] = useState(null);
            
            // Estado para o Player de Curso (SanarFlix/Geral)
            const [activeCourse, setActiveCourse] = useState(null);
            const [currentLessonIndex, setCurrentLessonIndex] = useState(0);
            
            // Estado para Subcurso Interno
            const [activeSubCourse, setActiveSubCourse] = useState(null);

            // --- NOVO ESTADO: Navegação da Biblioteca ---
            const [libraryPath, setLibraryPath] = useState([]);

            // --- NOVO ESTADO: Notificações ---
            const [showNotifications, setShowNotifications] = useState(false);

            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [activeSubTab, setActiveSubTab] = useState('conteudo'); 
            const [summaries, setSummaries] = useState({});
            const [isSaving, setIsSaving] = useState(false);

            // --- REF PARA CONTROLE DE SCROLL ---
            const scrollContainerRef = useRef(null);

            // --- DEFINIÇÃO DOS ITENS DE NAVEGAÇÃO (REUTILIZÁVEL) ---
            const navItems = [
                { id: 'dashboard', label: 'Início', icon: <Brain size={20} /> },
                { id: 'pbl', label: 'PBL', icon: <Users size={20} /> },
                { id: 'docs', label: 'Biblioteca', icon: <Library size={20} /> },
                { id: 'bq', label: 'BQ', icon: <FileQuestion size={20} /> },
            ];

            // --- EFEITO PARA ROLAR PARA O TOPO NA NAVEGAÇÃO ---
            useEffect(() => {
                if (scrollContainerRef.current) {
                    scrollContainerRef.current.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }, [activeTab, selectedSubject, activeCourse, activeSubCourse, libraryPath, activeSubTab]);

            useEffect(() => {
                if (searchQuery.trim().length > 1) {
                    const results = searchDatabase(searchQuery, DATA);
                    setSearchResults(results);
                } else {
                    setSearchResults([]);
                }
            }, [searchQuery]);

            // --- FUNÇÃO DE NAVEGAÇÃO ENTRE ABAS ---
            const handleTabSwitch = (tab) => {
                setActiveTab(tab);
                setSelectedSubject(null);
                setActiveCourse(null);
                setActiveSubCourse(null);
                setSearchQuery('');
                setLibraryPath([]);
            };

            const handleSubjectClick = (subject) => {
                setSelectedSubject(subject);
                setActiveSubTab('conteudo');
                setSearchQuery('');
                setActiveCourse(null);
                setActiveSubCourse(null);
            };

            const handleLibraryFolderClick = (folderId) => {
                setLibraryPath([...libraryPath, folderId]);
            };

            const handleLibraryBack = () => {
                setLibraryPath(libraryPath.slice(0, -1));
            };

            // --- FUNÇÃO GLOBAL DE VOLTAR ---
            const handleGlobalBack = () => {
                if (activeSubCourse) {
                    setActiveSubCourse(null);
                } else if (activeCourse) {
                    setActiveCourse(null);
                } else if (selectedSubject) {
                    setSelectedSubject(null);
                } else if (activeTab === 'docs' && libraryPath.length > 0) {
                    handleLibraryBack();
                }
            };

            // Verifica se o usuário está em uma navegação profunda
            const isDeepView = !!selectedSubject || !!activeCourse || !!activeSubCourse || (activeTab === 'docs' && libraryPath.length > 0);

            const handleCourseClick = (course) => {
                if (course.lessons && course.lessons.length > 0) {
                    setActiveCourse(course);
                    setCurrentLessonIndex(0);
                } else {
                    alert("Conteúdo em desenvolvimento ou não disponível.");
                }
            };
            
            const handleSubCourseClick = (course) => {
                if (course.lessons && course.lessons.length > 0) {
                    setActiveSubCourse(course);
                    setCurrentLessonIndex(0); 
                } 
                else if (course.file) {
                    handleOpenProblem(course.file);
                }
            };

            const handleSearchResultClick = (result) => {
                if (result.action === 'link') {
                    handleOpenProblem(result.path);
                } else if (result.action === 'module') {
                    handleSubjectClick(result.data);
                }
            };

            const handleOpenProblem = (file) => {
                if (!file) {
                    alert("Caminho do arquivo não configurado.");
                    return;
                }
                try {
                    window.open(file, '_blank');
                } catch (e) {
                    console.error("Erro ao tentar abrir janela:", e);
                    alert("Por favor, verifique se o bloqueador de popups está desativado.");
                }
            };

            const handleSaveSummary = () => {
                setIsSaving(true);
                setTimeout(() => setIsSaving(false), 800);
            };

            const clearSearch = () => {
                setSearchQuery('');
                setSearchResults([]);
            };

            const getCurrentLibraryData = () => {
                let currentLevel = LIBRARY_DATA;
                let currentTitle = "Biblioteca";
                let isRoot = libraryPath.length === 0;

                for (const pathId of libraryPath) {
                    const found = currentLevel.find(item => item.id === pathId);
                    if (found && found.children) {
                        currentLevel = found.children;
                        currentTitle = found.title;
                    }
                }
                return { data: currentLevel, title: currentTitle, isRoot };
            };

            const renderContent = () => {
                if (searchQuery.trim().length > 1) {
                    return <SearchResults results={searchResults} onSelect={handleSearchResultClick} />;
                }

                if (activeTab === 'docs') {
                    const { data, title, isRoot } = getCurrentLibraryData();

                    return (
                        <div className="animate-fade-in pb-20">
                            <div className="mb-8">
                                <h1 className="text-3xl font-bold text-white mb-2 flex items-center gap-3">
                                    <Library size={32} className="text-amber-500" />
                                    {isRoot ? "Biblioteca" : title}
                                </h1>
                                <p className="text-slate-400">
                                    {isRoot ? "Seu acervo digital de conhecimento." : "Materiais e documentos."}
                                </p>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                                {data.map((item, idx) => {
                                    if (item.type === 'folder') {
                                        return (
                                            <div 
                                                key={idx}
                                                onClick={() => handleLibraryFolderClick(item.id)}
                                                className={`bg-gradient-to-br ${item.color} p-6 rounded-2xl cursor-pointer hover:shadow-lg hover:scale-[1.02] transition-all group border border-white/5`}
                                            >
                                                <div className="flex justify-between items-start mb-4">
                                                    <div className="p-3 bg-white/20 rounded-xl text-white backdrop-blur-sm">
                                                        {item.icon}
                                                    </div>
                                                    <FolderOpen size={20} className="text-white/50 group-hover:text-white transition-colors" />
                                                </div>
                                                <h3 className="text-xl font-bold text-white mb-1">{item.title}</h3>
                                                <p className="text-white/70 text-xs">{item.description}</p>
                                            </div>
                                        );
                                    } else if (item.type === 'file') {
                                        return (
                                            <div 
                                                key={idx}
                                                onClick={() => window.open(item.url, '_blank')}
                                                className="bg-slate-800 border border-slate-700 hover:border-blue-500/50 p-4 rounded-xl cursor-pointer hover:bg-slate-750 hover:-translate-y-1 transition-all group flex items-start gap-3"
                                            >
                                                <div className="p-2.5 bg-red-500/10 text-red-400 rounded-lg group-hover:bg-red-500 group-hover:text-white transition-all mt-1">
                                                    <FileText size={20} />
                                                </div>
                                                <div className="flex-1 min-w-0">
                                                    <h4 className="font-medium text-slate-200 text-sm group-hover:text-white transition-colors leading-snug break-words">
                                                        {item.title}
                                                    </h4>
                                                    <span className="text-[10px] text-slate-500 mt-1.5 flex items-center gap-1">
                                                        PDF • Google Drive <ExternalLink size={10} />
                                                    </span>
                                                </div>
                                            </div>
                                        );
                                    }
                                    return null;
                                })}
                            </div>
                        </div>
                    );
                }

                if (activeCourse) {
                    return (
                        <CoursePlayer 
                            course={activeCourse}
                            onBack={() => setActiveCourse(null)}
                            currentLessonIndex={currentLessonIndex}
                            setCurrentLessonIndex={setCurrentLessonIndex}
                        />
                    );
                }

                if (selectedSubject) {
                    if (activeSubCourse) {
                         return (
                            <CoursePlayer 
                                course={activeSubCourse}
                                onBack={() => setActiveSubCourse(null)}
                                currentLessonIndex={currentLessonIndex}
                                setCurrentLessonIndex={setCurrentLessonIndex}
                                parentTitle={selectedSubject.title} 
                            />
                        );
                    }

                    if (selectedSubject.theme) {
                        if (selectedSubject.id === 'sanar_main') {
                            return (
                                <div className="animate-fade-in pb-20">
                                    <SanarflixSection 
                                        subjects={selectedSubject.subcourses}
                                        onSubjectClick={handleCourseClick}
                                    />
                                </div>
                            );
                        }

                         return (
                            <div className="animate-fade-in pb-20">
                                <PlatformSection 
                                    title={selectedSubject.title} 
                                    subtitle={selectedSubject.subtitle}
                                    subjects={selectedSubject.subcourses}
                                    theme={selectedSubject.theme}
                                    onSubjectClick={handleCourseClick}
                                />
                            </div>
                         );
                    }

                    // --- MÓDULOS DE TUTORIA/CURSOS NORMAIS ---
                    const problems = selectedSubject.problems || [];
                    const questions = selectedSubject.questions || [];

                    return (
                        <div className="animate-fade-in pb-20">
                            {/* GLOBAL BACK BUTTON (INSIDE CONTENT AREA) */}
                            <div className="max-w-[1800px] mx-auto mb-6">
                                 <button 
                                    onClick={handleGlobalBack}
                                    className="flex items-center gap-2 text-slate-400 hover:text-white transition-colors group"
                                 >
                                    <div className="p-2 rounded-full bg-slate-800 border border-slate-700 group-hover:bg-slate-700 transition-all">
                                        <ArrowLeft size={18} />
                                    </div>
                                    <span className="font-medium text-sm">Voltar</span>
                                 </button>
                            </div>

                            <div className={`h-48 rounded-3xl bg-gradient-to-r ${selectedSubject.color} relative mb-6 flex items-end p-8 shadow-xl`}>
                                <div>
                                    <span className="text-white/80 uppercase tracking-wider text-xs font-bold mb-2 block">Matéria / Módulo</span>
                                    <h1 className="text-3xl md:text-4xl font-bold text-white mb-2">{selectedSubject.title}</h1>
                                </div>
                            </div>

                            <div className="flex gap-6 mb-8 border-b border-slate-700 px-2 overflow-x-auto">
                                <button 
                                    onClick={() => setActiveSubTab('conteudo')} 
                                    className={`pb-3 px-2 text-sm font-medium border-b-2 transition-all duration-200 whitespace-nowrap ${activeSubTab === 'conteudo' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-200'}`}
                                >
                                    Conteúdos
                                </button>
                                <button 
                                    onClick={() => setActiveSubTab('resumo')} 
                                    className={`pb-3 px-2 text-sm font-medium border-b-2 transition-all duration-200 whitespace-nowrap ${activeSubTab === 'resumo' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-200'}`}
                                >
                                    Resumos & Problemas
                                </button>
                                <button 
                                    onClick={() => setActiveSubTab('questoes')} 
                                    className={`pb-3 px-2 text-sm font-medium border-b-2 transition-all duration-200 whitespace-nowrap ${activeSubTab === 'questoes' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-200'}`}
                                >
                                    Questões (ATP)
                                </button>
                            </div>

                            <div className="px-2">
                                {activeSubTab === 'conteudo' && (
                                    <div className="animate-fade-in space-y-10">
                                        {selectedSubject.subcourses && selectedSubject.subcourses.length > 0 ? (
                                            <div className="flex flex-col gap-3">
                                                {selectedSubject.subcourses.map((course) => (
                                                    <div 
                                                        key={course.id} 
                                                        onClick={() => handleSubCourseClick(course)}
                                                        className={`w-full bg-slate-800 border border-slate-700 hover:border-blue-500/50 p-4 rounded-xl cursor-pointer hover:bg-slate-750 transition-all group flex items-center justify-between shadow-sm hover:shadow-md hover:translate-x-1 ${course.lessons || course.file ? '' : ''}`}
                                                    >
                                                        <div className="flex items-center gap-4">
                                                            <div className={`p-2.5 rounded-lg text-white bg-gradient-to-br ${selectedSubject.color} shadow-sm`}>
                                                                <PlayCircle size={20} />
                                                            </div>
                                                            <div>
                                                                <h4 className="text-sm font-bold text-slate-200 group-hover:text-white transition-colors">{course.title}</h4>
                                                                <p className="text-xs text-slate-500 mt-0.5">{course.type || 'Módulo'}</p>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="flex items-center text-xs font-medium text-slate-500 group-hover:text-blue-400 transition-colors">
                                                            {course.lessons ? 'Ver Aulas' : 'Abrir'} <ChevronRight size={14} className="ml-1.5" />
                                                        </div>
                                                    </div>
                                                ))}
                                                {/* Botão de Adicionar - Removido para limpeza visual ou mantido como opcional */}
                                            </div>
                                        ) : (
                                            (!selectedSubject.simulados || selectedSubject.simulados.length === 0) && !selectedSubject.isPlaceholder && (
                                                <div className="flex flex-col items-center justify-center p-10 border border-dashed border-slate-700 rounded-xl bg-slate-800/20">
                                                    <h4 className="text-xl font-bold text-slate-400 mb-2">Conteúdo em Desenvolvimento</h4>
                                                    <p className="text-slate-500 text-center max-w-md">Vá para as abas de Resumos ou Questões para ver o material disponível.</p>
                                                </div>
                                            )
                                        )}

                                        {selectedSubject.simulados && selectedSubject.simulados.length > 0 && (
                                            <div>
                                                <h3 className="text-lg font-bold text-white mb-4 pl-1 border-l-4 border-blue-500 flex items-center gap-3 mt-8">
                                                    Análises e Simulados
                                                </h3>
                                                <div className="flex flex-col gap-3">
                                                    {selectedSubject.simulados.map((simulado) => (
                                                        <div 
                                                            key={simulado.id} 
                                                            onClick={() => handleOpenProblem(simulado.file)}
                                                            className="w-full bg-slate-800 border border-slate-700 hover:border-blue-500/50 p-4 rounded-xl cursor-pointer hover:bg-slate-750 transition-all group flex items-center justify-between shadow-sm hover:shadow-md hover:translate-x-1"
                                                        >
                                                            <div className="flex items-center gap-4">
                                                                <div className="p-2.5 bg-blue-500/10 rounded-lg text-blue-400 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                                                    <Activity size={20} />
                                                                </div>
                                                                <div>
                                                                    <h4 className="text-sm font-bold text-slate-200 group-hover:text-white transition-colors">{simulado.title}</h4>
                                                                    <p className="text-xs text-slate-500 mt-0.5">Documento HTML</p>
                                                                </div>
                                                            </div>
                                                            <ExternalLink size={14} className="text-slate-600 group-hover:text-blue-400 transition-colors" />
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {activeSubTab === 'resumo' && (
                                    <div className="animate-fade-in">
                                        {selectedSubject.problems && selectedSubject.problems.length > 0 ? (
                                            <div className="flex flex-col gap-3">
                                                {selectedSubject.problems.map((problem) => (
                                                    <div 
                                                        key={problem.id}
                                                        onClick={() => handleOpenProblem(problem.file)}
                                                        data-title={problem.title}
                                                        data-type="resumo"
                                                        data-module={problem.moduleRef}
                                                        className="w-full bg-slate-800 border border-slate-700 hover:border-blue-500/50 p-4 rounded-xl cursor-pointer hover:bg-slate-750 transition-all group flex items-center justify-between shadow-sm hover:shadow-md hover:translate-x-1"
                                                    >
                                                        <div className="flex items-center gap-4">
                                                            <div className="p-2.5 bg-blue-500/10 rounded-lg text-blue-400 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                                                <FileSearch size={20} />
                                                            </div>
                                                            <div>
                                                                <h3 className="text-sm font-bold text-slate-200 group-hover:text-white transition-colors">
                                                                    {problem.title}
                                                                </h3>
                                                                <p className="text-xs text-slate-500 mt-0.5">Documento de Apoio</p>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="flex items-center text-xs font-medium text-slate-500 group-hover:text-blue-400 transition-colors">
                                                            Abrir <ExternalLink size={14} className="ml-1.5" />
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="bg-slate-800/40 border border-slate-700 rounded-2xl p-6">
                                                <div className="flex justify-between items-center mb-4">
                                                    <div>
                                                        <h3 className="text-lg font-bold text-white flex items-center gap-2">
                                                            <FileText size={20} className="text-blue-400"/> Resumo: {selectedSubject.title}
                                                        </h3>
                                                        <p className="text-sm text-slate-400">Escreva seus objetivos de aprendizado ou resumo das discussões aqui.</p>
                                                    </div>
                                                    <button 
                                                        onClick={handleSaveSummary}
                                                        className={`px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-2 transition-all ${isSaving ? 'bg-green-600 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                                                    >
                                                        {isSaving ? <Check size={16} /> : <Save size={16} />}
                                                        {isSaving ? 'Salvo!' : 'Salvar'}
                                                    </button>
                                                </div>
                                                <textarea 
                                                    className="w-full h-[500px] bg-slate-900/50 border border-slate-700 rounded-xl p-6 text-slate-300 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 resize-none font-mono leading-relaxed"
                                                    placeholder={`Digite aqui o resumo para o ${selectedSubject.title}...\n\nExemplo:\n- Objetivos do caso\n- Fisiopatologia principal\n- Conduta terapêutica`}
                                                    value={summaries[selectedSubject.id] || ''}
                                                    onChange={(e) => setSummaries({...summaries, [selectedSubject.id]: e.target.value})}
                                                ></textarea>
                                                <div className="mt-2 text-xs text-slate-500 flex justify-end">
                                                    {summaries[selectedSubject.id] ? `${summaries[selectedSubject.id].length} caracteres` : '0 caracteres'}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {activeSubTab === 'questoes' && (
                                    <div className="animate-fade-in">
                                        {selectedSubject.questions && selectedSubject.questions.length > 0 ? (
                                            <div className="flex flex-col gap-3">
                                                {selectedSubject.questions.map((question) => (
                                                    <div 
                                                        key={question.id}
                                                        onClick={() => handleOpenProblem(question.file)}
                                                        data-title={question.title}
                                                        data-type="questao"
                                                        data-module={question.moduleRef}
                                                        className="w-full bg-slate-800 border border-slate-700 hover:border-amber-500/50 p-4 rounded-xl cursor-pointer hover:bg-slate-750 transition-all group flex items-center justify-between shadow-sm hover:shadow-md hover:translate-x-1"
                                                    >
                                                        <div className="flex items-center gap-4">
                                                            <div className="p-2.5 bg-amber-500/10 rounded-lg text-amber-400 group-hover:bg-amber-500 group-hover:text-white transition-colors">
                                                                <FileQuestion size={20} />
                                                            </div>
                                                            <div>
                                                                <h3 className="text-sm font-bold text-slate-200 group-hover:text-white transition-colors">
                                                                    {question.title}
                                                                </h3>
                                                                <p className="text-xs text-slate-500 mt-0.5">ATP - Avaliação Tutorial</p>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="flex items-center text-xs font-medium text-slate-500 group-hover:text-amber-400 transition-colors">
                                                            Abrir <ExternalLink size={14} className="ml-1.5" />
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="flex flex-col items-center justify-center p-16 border border-dashed border-slate-700 rounded-xl bg-slate-800/20">
                                                <FileQuestion size={48} className="text-slate-600 mb-4" />
                                                <h4 className="text-xl font-bold text-slate-400 mb-2">Sem Questões Cadastradas</h4>
                                                <p className="text-slate-500 text-center max-w-md">Não há questionários disponíveis para este módulo no momento.</p>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    );
                }

                if (activeTab === 'dashboard') {
                    return (
                        <div className="animate-fade-in pb-20">
                            <div className="mb-10 mt-4">
                                <h1 className="text-3xl font-bold text-white mb-2">"A medicina é a arte de curar, mas também a ciência de cuidar."</h1>
                                <p className="text-slate-400">Continue firme nos estudos!</p>
                            </div>
                            
                            <CarouselSection 
                                title="Cursos Principais" 
                                icon={<MonitorPlay />}
                                subjects={[DATA.platforms.sanar, DATA.platforms.emr]} 
                                onSubjectClick={(subject) => {
                                    handleSubjectClick(subject);
                                }}
                            />

                            <CarouselSection 
                                title="Ciclo Básico" 
                                icon={<Microscope />}
                                subjects={DATA.basico.subjects} 
                                onSubjectClick={handleSubjectClick} 
                            />
                            
                            <CarouselSection 
                                title="Ciclo Clínico" 
                                icon={<Stethoscope />}
                                subjects={DATA.clinico.subjects} 
                                onSubjectClick={handleSubjectClick} 
                            />
                            
                            <CarouselSection 
                                title="Internato" 
                                icon={<Activity />}
                                subjects={DATA.internato.subjects} 
                                onSubjectClick={handleSubjectClick} 
                            />
                        </div>
                    );
                }

                if (activeTab === 'pbl') {
                    return (
                        <div className="animate-fade-in pb-20">
                            <div className="mb-8 mt-4 flex items-center gap-4">
                                <div className="p-3 bg-blue-600/20 rounded-xl text-blue-500 border border-blue-500/20"><Users size={32} /></div>
                                <div><h1 className="text-3xl font-bold text-white mb-1">PBL & Tutorias</h1><p className="text-slate-400">Aprendizado Baseado em Problemas</p></div>
                            </div>
                            
                            <CarouselSection 
                                title="Ciclo Básico" 
                                icon={<Brain />}
                                subjects={DATA.pbl_basico.subjects} 
                                onSubjectClick={handleSubjectClick} 
                            />

                            <CarouselSection 
                                title="Ciclo Clínico" 
                                icon={<FileText />}
                                subjects={DATA.pbl_clinico.subjects} 
                                onSubjectClick={handleSubjectClick} 
                            />

                            <CarouselSection 
                                title="Habilidades Médicas" 
                                icon={<GraduationCap />}
                                subjects={DATA.pbl.subjects} 
                                onSubjectClick={handleSubjectClick} 
                            />
                            
                            <div className="mt-8 bg-slate-800/50 rounded-2xl p-6 border border-slate-700">
                                <h3 className="text-xl font-bold text-slate-200 mb-4">Anotações Gerais</h3>
                                <textarea className="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-slate-300 focus:outline-none focus:border-blue-500 h-32" placeholder="Notas rápidas que não pertencem a um módulo específico..."></textarea>
                            </div>
                        </div>
                    );
                }

                // Conteúdo para a aba BQ (Banco de Questões)
                if (activeTab === 'bq') {
                    return (
                        <div className="animate-fade-in pb-20">
                            <div className="mb-8 mt-4 flex items-center gap-4">
                                <div className="p-3 bg-blue-600/20 rounded-xl text-blue-500 border border-blue-500/20"><FileQuestion size={32} /></div>
                                <div><h1 className="text-3xl font-bold text-white mb-1">Banco de Questões</h1><p className="text-slate-400">Treine seus conhecimentos</p></div>
                            </div>
                            
                            <div className="flex flex-col items-center justify-center p-12 border border-slate-700 rounded-2xl bg-slate-800/50 text-center max-w-2xl mx-auto mt-10 shadow-2xl">
                                <div className="w-24 h-24 bg-blue-500/10 rounded-full flex items-center justify-center mb-6 border border-blue-500/20 shadow-inner">
                                    <Activity size={48} className="text-blue-500" />
                                </div>
                                
                                <h2 className="text-3xl font-bold text-white mb-4">Funcionalidade em Beta</h2>
                                
                                <p className="text-slate-400 mb-10 leading-relaxed max-w-md text-lg">
                                    O Banco de Questões está em fase de testes para garantir a melhor experiência de estudo. Você pode acessar a versão preliminar clicando abaixo.
                                </p>
                                
                                <button 
                                    onClick={() => window.open('Banco de Questões/banco de questões.html', '_blank')}
                                    className="px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold transition-all shadow-lg shadow-blue-900/40 hover:scale-105 flex items-center gap-3 text-lg"
                                >
                                    Acessar Banco de Questões <ExternalLink size={20} />
                                </button>
                                
                                <p className="mt-6 text-xs text-slate-500">
                                    *Ao clicar, uma nova página será aberta com o simulado.
                                </p>
                            </div>
                        </div>
                    );
                }
                
                return <div className="text-white mt-10 text-center">Área em construção...</div>;
            };

            return (
                <div className="flex h-screen bg-[#0F172A] font-sans overflow-hidden text-slate-300 selection:bg-blue-500/30 flex-col">
                    
                    {/* HEADER UNIFICADO COM NAVEGAÇÃO SUPERIOR */}
                    <header className="h-20 border-b border-slate-700/50 bg-[#0F172A]/80 backdrop-blur-md flex items-center justify-between px-4 lg:px-12 sticky top-0 z-50 transition-all duration-300 hover:bg-[#0F172A]">
                        
                        {/* Esquerda: Logo & Menu Principal */}
                        <div className="flex items-center gap-4 lg:gap-12 flex-shrink-0">
                            {/* Logo */}
                            <div 
                                className="flex items-center gap-1 cursor-pointer group"
                                onClick={() => handleTabSwitch('dashboard')}
                            >
                                <span className="font-extrabold text-blue-500 text-xl lg:text-3xl tracking-tighter">MEDNEXUS</span>
                            </div>

                            {/* Navegação - Apenas Ícones (Logos) no Topo - Compacto */}
                            <nav className="flex items-center gap-1 lg:gap-3 overflow-x-auto no-scrollbar mask-linear-fade">
                                {navItems.map(item => (
                                    <button
                                        key={item.id}
                                        /* CORREÇÃO: Agora todos os botões apenas trocam a aba interna */
                                        onClick={() => handleTabSwitch(item.id)}
                                        className={`flex flex-col items-center justify-center w-12 h-12 lg:w-14 lg:h-14 transition-all duration-300 relative group rounded-lg ${
                                            activeTab === item.id 
                                            ? 'text-white bg-slate-800/50' 
                                            : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800/30'
                                        }`}
                                        title={item.label}
                                    >
                                        {/* Renderiza o ícone menor para caber melhor */}
                                        {React.cloneElement(item.icon, { size: 20 })}
                                        
                                        <span className="text-[9px] mt-0.5 opacity-80">{item.label}</span>

                                        {/* Indicador de Aba Ativa (Barra inferior) */}
                                        {activeTab === item.id && (
                                            <span className="absolute bottom-1 w-1 h-1 bg-blue-500 rounded-full"></span>
                                        )}
                                    </button>
                                ))}
                            </nav>
                        </div>

                        {/* Centro/Direita: Pesquisa, Voltar e Perfil */}
                        <div className="flex items-center justify-end gap-2 lg:gap-4 ml-auto flex-shrink-0">
                            {/* Barra de Pesquisa */}
                            <div className="relative group hidden sm:block">
                                <div className={`flex items-center bg-slate-800 border border-slate-600 px-2 py-1.5 rounded-full transition-all ${searchQuery ? 'w-40 lg:w-56' : 'w-40 lg:w-56'}`}>
                                    <Search className="text-white mr-2" size={16} />
                                    <input 
                                        type="text" 
                                        placeholder="Pesquisar..." 
                                        className="bg-transparent border-none text-white text-xs focus:outline-none w-full placeholder-slate-400"
                                        value={searchQuery} 
                                        onChange={(e) => setSearchQuery(e.target.value)} 
                                    />
                                    {searchQuery && (
                                        <button onClick={clearSearch} className="text-white ml-1">
                                            <X size={12} />
                                        </button>
                                    )}
                                </div>
                            </div>

                            {/* Ações de Perfil e Notificações */}
                            <div className="flex items-center gap-2 lg:gap-4">
                                <button className="relative text-slate-400 hover:text-white transition-colors p-1">
                                    <Bell size={18} className="lg:w-5 lg:h-5" />
                                    <span className="absolute top-0 right-0 w-2 h-2 bg-blue-500 rounded-full border-2 border-[#0F172A]"></span>
                                </button>
                                <div className="w-8 h-8 rounded-full bg-slate-700 border border-slate-600 flex items-center justify-center text-slate-300 font-medium text-xs">DR</div>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 overflow-hidden relative">
                         <div 
                            ref={scrollContainerRef}
                            className="absolute inset-0 overflow-y-auto p-6 lg:p-8 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent"
                        >
                            <div className="max-w-7xl mx-auto pb-20">
                                {renderContent()}
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<MedStudyHub />);
    </script>
</body>
</html>
